<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI CV Evaluation</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background: linear-gradient(135deg, #e3f2fd, #bbdefb);
      font-family: "Poppins", sans-serif;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .container {
      max-width: 600px;
      background: #ffffff;
      padding: 40px;
      border-radius: 16px;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
      transition: all 0.3s ease;
    }

    h2 {
      font-weight: 700;
      margin-bottom: 30px;
      text-align: center;
      color: #0d47a1;
    }

    .form-control, .form-select {
      padding: 12px;
      border-radius: 10px;
      border: 1px solid #ccc;
    }

    button {
      background: linear-gradient(90deg, #007bff, #0d47a1);
      color: white;
      font-weight: 600;
      border: none;
      border-radius: 10px;
      padding: 12px;
      width: 100%;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    button:hover {
      background: linear-gradient(90deg, #0056b3, #002171);
    }

    #response {
      margin-top: 25px;
      padding: 20px;
      border-radius: 10px;
      display: none;
      font-size: 16px;
      line-height: 1.6;
      animation: fadeIn 0.5s ease-in-out;
      white-space: pre-wrap; /* Keep new lines from AI text */
    }

    #response.success {
      background-color: #e8f5e9;
      color: #2e7d32;
      border-left: 5px solid #43a047;
    }

    #response.error {
      background-color: #ffebee;
      color: #c62828;
      border-left: 5px solid #e53935;
    }

    #loading {
      text-align: center;
      margin-top: 20px;
      display: none;
    }

    .spinner-border {
      color: #0d47a1;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>ü§ñ AI CV Evaluation</h2>

    <form id="cvForm" enctype="multipart/form-data">
      <div class="mb-3">
        <input type="text" name="name" class="form-control" placeholder="Full Name" required>
      </div>
      <div class="mb-3">
        <input type="email" name="email" class="form-control" placeholder="Email Address" required>
      </div>
      <div class="mb-3">
        <select name="field" class="form-select" required>
          <option value="">Select Field</option>
          <option>AI</option>
          <option>DevOps</option>
          <option>Cloud</option>
          <option>BI</option>
        </select>
      </div>
      <div class="mb-3">
        <input type="file" name="cv" class="form-control" accept=".pdf,.doc,.docx" required>
      </div>
      <button type="submit">Submit CV</button>
    </form>

    <div id="loading">
      <div class="spinner-border" role="status"></div>
      <p class="mt-2">Analyzing your CV with AI...</p>
    </div>

    <div id="response"></div>
  </div>

<script>
document.getElementById("cvForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  const formData = new FormData(e.target);
  const resDiv = document.getElementById("response");
  const loading = document.getElementById("loading");

  // Reset UI
  resDiv.style.display = "none";
  resDiv.className = "";
  resDiv.innerHTML = "";
  loading.style.display = "block";

  try {
    const response = await fetch("http://127.0.0.1:5678/submit", {
      method: "POST",
      body: formData
    });

    let data;
    const contentType = response.headers.get("content-type") || "";

    if (contentType.includes("application/json")) {
      data = await response.json();
    } else {
      const text = await response.text();
      data = { text }; // wrap plain text in object
    }

    console.log("Frontend received:", data);

    loading.style.display = "none";
    resDiv.style.display = "block";

    // Show error if exists
    if (data.error) {
      resDiv.className = "error";
      resDiv.innerHTML = `‚ö†Ô∏è Error: ${data.error}`;
    } 
    // Show wrapped plain text
    else if (data.text) {
      resDiv.className = "success";
      resDiv.innerHTML = `<b>üß† AI Feedback:</b><br>${data.text.replace(/\n/g, "<br>")}`;
    } 
    // Show structured JSON (score + feedback)
    else if (data.score && data.feedback) {
      resDiv.className = "success";
      resDiv.innerHTML = `
        <b>üßÆ Score:</b> ${data.score}<br>
        <b>üí¨ Feedback:</b><br>${data.feedback.replace(/\n/g, "<br>")}
      `;
    } 
    // Fallback for unknown JSON structure
    else {
      resDiv.className = "success";
      resDiv.innerHTML = `üß† AI Response:<br>${JSON.stringify(data, null, 2).replace(/\n/g, "<br>")}`;
    }

  } catch (err) {
    loading.style.display = "none";
    resDiv.style.display = "block";
    resDiv.className = "error";
    resDiv.innerHTML = "‚ö†Ô∏è Failed to connect to backend. Please try again.";
    console.error("Fetch error:", err);
  }
});
</script>


</body>
</html>
